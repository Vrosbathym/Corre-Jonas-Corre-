<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Corre, Jonas, Corre!</title>
    <link rel="icon" type="image/png" href="pedroaugusto.png">
    <link rel="apple-touch-icon" href="pedroaugusto.png">
<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background-color: #222; -webkit-user-select: none; user-select: none; }
    canvas { display: block; border: none; cursor: pointer; }
    p { display: none; }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<p>Use Toque/Clique no menu/loja/líderes. Pressione ESPAÇO ou Toque para pular. Pressione ESPAÇO ou Toque na tela de Game Over para voltar ao menu.</p>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        if (!canvas || !ctx) { console.error("Canvas/Contexto não encontrado!"); return; }

        // Assets (igual)
        let playerImage=new Image(); let obstacleImage=new Image(); let backgroundImage=new Image(); let coinImage=new Image(); let lifeImage=new Image(); let jumpSound=new Audio('uoh.mp3'); let gameOverSound=new Audio('fail.mp3'); let assetsLoaded=0; const totalAssets=5; let playerImageLoaded, obstacleImageLoaded, backgroundImageLoaded, coinImageLoaded, lifeImageLoaded = false;

        // Valores Base (igual)
        const baseWidth=600;const baseHeight=300;const basePlayerWidth=40;const basePlayerHeight=40;const baseHitboxXOffset=5;const baseHitboxYOffset=5;const baseObstacleWidth=25;const baseObstacleHeight=45;const baseGravity=0.4;const baseJumpStrength=-9;const baseDoubleJumpStrength=-7;const baseGroundHeight=15;const baseObstacleSpeed=5.0; /* Velocidade 4.0 */ const baseIconSize=20;const baseButtonWidth=200;const baseButtonHeight=45;const costOfSingleLife=5;const maxTotalLives=10;

        // Variáveis Dinâmicas (igual)
        let playerWidth,playerHeight,playerX,playerY,velocityY;let hitboxXOffset,hitboxYOffset,playerHitboxWidth,playerHitboxHeight;let gravity,jumpStrength,doubleJumpStrength,onGround,canDoubleJump;let groundY;let obstacles=[],obstacleDrawWidth,obstacleDrawHeight; let obstacleSpawnTimer=0,nextSpawnInterval=120;const minSpawnInterval=70,maxSpawnInterval=150;let aerialObstacleMinY,aerialObstacleMaxY;let score=0,isGameOver=false,animationFrameId=null;let scaleFactorHeight=1,scaleFactorWidth=1;const skyColor="#87CEEB";let iconSize,buttonWidth,buttonHeight;

        // Estado e Loja (igual)
        let gameState='LOADING';let coins=0;let purchasedExtraLives=0;const startingLivesBase=1;let currentLives=0;let isInvincible=false;let invincibilityTimer=0;const invincibilityDuration=90;let shopMessage="";let shopMessageTimer=0;

        // Leaderboard (igual)
        let leaderboardData=[];const LEADERBOARD_KEY="scorpionRunnerLeaderboard";const MAX_LEADERBOARD_ENTRIES=5;

        // Botões (igual)
        let startButtonRect, shopButtonRect, leaderboardButtonRect, shopBackButtonRect, shopBuyLivesButtonRect, leaderboardBackButtonRect = null;

        // Persistência (igual)
        const COINS_KEY="scorpionRunnerCoins";const LIVES_KEY="scorpionRunnerExtraLives";function saveData(){try{localStorage.setItem(COINS_KEY,coins.toString());localStorage.setItem(LIVES_KEY,purchasedExtraLives.toString());localStorage.setItem(LEADERBOARD_KEY,JSON.stringify(leaderboardData));}catch(e){console.error("Erro save localStorage:",e);}}function loadData(){try{const sC=localStorage.getItem(COINS_KEY);const sL=localStorage.getItem(LIVES_KEY);const sLB=localStorage.getItem(LEADERBOARD_KEY);coins=sC!==null?parseInt(sC,10):0;purchasedExtraLives=sL!==null?parseInt(sL,10):0;if(sLB){leaderboardData=JSON.parse(sLB);}else{leaderboardData=[];}if(isNaN(coins))coins=0;if(isNaN(purchasedExtraLives))purchasedExtraLives=0;if(!Array.isArray(leaderboardData))leaderboardData=[];sortLeaderboard();}catch(e){console.error("Erro load localStorage:",e);coins=0;purchasedExtraLives=0;leaderboardData=[];}}

        // Funções Leaderboard (igual)
        function sortLeaderboard(){leaderboardData.sort((a,b)=>b.score-a.score);}function addScoreToLeaderboard(name,score){leaderboardData.push({name:name,score:score});sortLeaderboard();leaderboardData.splice(MAX_LEADERBOARD_ENTRIES);saveData();}function checkHighScore(currentScore){if(leaderboardData.length<MAX_LEADERBOARD_ENTRIES||currentScore>(leaderboardData[leaderboardData.length-1]?.score ?? -1)){return true;}return false;}

        // Redimensionamento (igual)
        function resizeAndScale(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;scaleFactorHeight=canvas.height/baseHeight;scaleFactorWidth=canvas.width/baseWidth;playerHeight=basePlayerHeight*scaleFactorHeight;playerWidth=basePlayerWidth*scaleFactorHeight;obstacleDrawHeight=baseObstacleHeight*scaleFactorHeight;obstacleDrawWidth=baseObstacleWidth*scaleFactorHeight;hitboxXOffset=baseHitboxXOffset*scaleFactorHeight;hitboxYOffset=baseHitboxYOffset*scaleFactorHeight;playerHitboxWidth=playerWidth-(hitboxXOffset*2);playerHitboxHeight=playerHeight-(hitboxYOffset*2);iconSize=baseIconSize*scaleFactorHeight;buttonWidth=baseButtonWidth*scaleFactorWidth;buttonHeight=baseButtonHeight*scaleFactorHeight;playerX=50*scaleFactorWidth;groundY=canvas.height-(baseGroundHeight*scaleFactorHeight);gravity=baseGravity*scaleFactorHeight;jumpStrength=baseJumpStrength*scaleFactorHeight;doubleJumpStrength=baseDoubleJumpStrength*scaleFactorHeight; aerialObstacleMinY=groundY-obstacleDrawHeight-playerHeight*1.8;aerialObstacleMaxY=groundY-obstacleDrawHeight-playerHeight*1.1;const th=buttonHeight*3+(buttonHeight*0.4)*2;const msy=(canvas.height-th)/2;const bs=buttonHeight*0.4;startButtonRect={x:canvas.width/2-buttonWidth/2,y:msy,width:buttonWidth,height:buttonHeight};shopButtonRect={x:canvas.width/2-buttonWidth/2,y:msy+buttonHeight+bs,width:buttonWidth,height:buttonHeight};leaderboardButtonRect={x:canvas.width/2-buttonWidth/2,y:msy+(buttonHeight+bs)*2,width:buttonWidth,height:buttonHeight};const bm=20*scaleFactorWidth;const bw=buttonWidth*0.8;const bh=buttonHeight*0.8;shopBackButtonRect={x:canvas.width-bw-bm,y:canvas.height-bh-bm,width:bw,height:bh};const buyY=(100+35+40)*scaleFactorHeight;shopBuyLivesButtonRect={x:canvas.width/2-buttonWidth/2,y:buyY,width:buttonWidth,height:buttonHeight};leaderboardBackButtonRect={x:canvas.width-bw-bm,y:canvas.height-bh-bm,width:bw,height:bh};if(gameState!=='LOADING'){draw();}}

        // Carregamento (igual)
        function onAllAssetsLoaded(){loadData();gameState='MENU';resizeAndScale();gameLoop();}function assetLoaded(){assetsLoaded++;if(assetsLoaded===totalAssets){onAllAssetsLoaded();}}
        playerImage.onload=()=>{playerImageLoaded=true;assetLoaded();};playerImage.onerror=()=>{console.error("Erro 'images.png'.");};obstacleImage.onload=()=>{obstacleImageLoaded=true;assetLoaded();};obstacleImage.onerror=()=>{console.error("Erro 'pedroaugusto.png'.");};backgroundImage.onload=()=>{backgroundImageLoaded=true;assetLoaded();};backgroundImage.onerror=()=>{console.error("Erro 'fundo.png'.");};coinImage.onload=()=>{coinImageLoaded=true;assetLoaded();};coinImage.onerror=()=>{console.error("Erro 'coin.png'.");};lifeImage.onload=()=>{lifeImageLoaded=true;assetLoaded();};lifeImage.onerror=()=>{console.error("Erro 'vida.png'.");};

        // Ação Principal (Espaço - Pulo e Voltar Menu)
        function handlePrimaryAction(){switch(gameState){case'PLAYING':if(onGround){jumpSound.currentTime=0;jumpSound.play();velocityY=jumpStrength;onGround=false;canDoubleJump=true;}else if(canDoubleJump){jumpSound.currentTime=0;jumpSound.play();velocityY=doubleJumpStrength;canDoubleJump=false;}break;case'GAME_OVER':isGameOver=false;gameState='MENU';break;}}

        // Funções do Jogo (reset, spawn, update - iguais, update usa baseObstacleSpeed)
        function resetGame(){if(!animationFrameId&&gameState==='PLAYING'){gameLoop();}playerY=groundY-playerHeight;velocityY=0;obstacles=[];score=0;obstacleSpawnTimer=0;nextSpawnInterval=120;isGameOver=false;onGround=true;canDoubleJump=false;currentLives=startingLivesBase+purchasedExtraLives;isInvincible=false;invincibilityTimer=0;}
        function spawnObstacle(){let oY,t;if(Math.random()<0.5){t='ground';oY=groundY-obstacleDrawHeight;}else{t='air';oY=Math.random()*(aerialObstacleMaxY-aerialObstacleMinY)+aerialObstacleMinY;}obstacles.push({x:canvas.width,y:oY,width:obstacleDrawWidth,height:obstacleDrawHeight,image:obstacleImage,type:t,scored:false});nextSpawnInterval=Math.floor(Math.random()*(maxSpawnInterval-minSpawnInterval+1))+minSpawnInterval;}
        function update(){if(gameState!=='PLAYING'){if(isGameOver&&gameState!=='GAME_OVER')gameState='GAME_OVER';return;}if(isInvincible){invincibilityTimer--;if(invincibilityTimer<=0){isInvincible=false;}}if(!onGround){velocityY+=gravity;playerY+=velocityY;}if(playerY+playerHeight>=groundY){playerY=groundY-playerHeight;velocityY=0;if(!onGround){onGround=true;canDoubleJump=false;}}if(playerY<0){playerY=0;velocityY=0;}obstacleSpawnTimer++;if(obstacleSpawnTimer>=nextSpawnInterval){spawnObstacle();obstacleSpawnTimer=0;}for(let i=obstacles.length-1;i>=0;i--){let o=obstacles[i];o.x-=baseObstacleSpeed; /* Usa velocidade base */ if(o.x+o.width<0){obstacles.splice(i,1);continue;}let pX=playerX+hitboxXOffset;let pY=playerY+hitboxYOffset;if(!isInvincible&&pX<o.x+o.width&&pX+playerHitboxWidth>o.x&&pY<o.y+o.height&&pY+playerHitboxHeight>o.y){currentLives--;obstacles.splice(i,1);if(currentLives<=0){isGameOver=true;gameOverSound.currentTime=0;gameOverSound.play();if(purchasedExtraLives>0){purchasedExtraLives=0;saveData();console.log("Vidas extras resetadas para 0.");}if(checkHighScore(score)){let pN=prompt(`Novo Recorde!\nPontuação:${score}\nNome(3 letras):`,"AAA");if(pN){addScoreToLeaderboard(pN.substring(0,3).toUpperCase(),score);}else{addScoreToLeaderboard("???",score);}}gameState='GAME_OVER';return;}else{isInvincible=true;invincibilityTimer=invincibilityDuration;}}if(o.x+o.width<playerX&&!o.scored){score++;o.scored=true;if(score>0&&score%5===0){coins++;saveData();}}}}

        // Draw (igual v4.7)
        function draw() { try{if(backgroundImageLoaded){ctx.drawImage(backgroundImage,0,0,canvas.width,canvas.height);}else{ctx.fillStyle=skyColor;ctx.fillRect(0,0,canvas.width,canvas.height);}}catch(e){}if(gameState==='MENU'){try{if(obstacleImageLoaded){const d=1.2,w=obstacleDrawWidth*d,h=obstacleDrawHeight*d,s=h*1.2,y=(canvas.height-(3*h+2*(s-h)))/2,m=15*scaleFactorWidth,l=m,r=canvas.width-w-m;ctx.drawImage(obstacleImage,l,y,w,h);ctx.drawImage(obstacleImage,l,y+s,w,h);ctx.drawImage(obstacleImage,l,y+s*2,w,h);ctx.drawImage(obstacleImage,r,y,w,h);ctx.drawImage(obstacleImage,r,y+s,w,h);ctx.drawImage(obstacleImage,r,y+s*2,w,h);}ctx.fillStyle="#00A000";ctx.strokeStyle="#006400";ctx.lineWidth=2*scaleFactorHeight;if(startButtonRect){ctx.fillRect(startButtonRect.x,startButtonRect.y,startButtonRect.width,startButtonRect.height);ctx.strokeRect(startButtonRect.x,startButtonRect.y,startButtonRect.width,startButtonRect.height);}if(shopButtonRect){ctx.fillRect(shopButtonRect.x,shopButtonRect.y,shopButtonRect.width,shopButtonRect.height);ctx.strokeRect(shopButtonRect.x,shopButtonRect.y,shopButtonRect.width,shopButtonRect.height);}if(leaderboardButtonRect){ctx.fillRect(leaderboardButtonRect.x,leaderboardButtonRect.y,leaderboardButtonRect.width,leaderboardButtonRect.height);ctx.strokeRect(leaderboardButtonRect.x,leaderboardButtonRect.y,leaderboardButtonRect.width,leaderboardButtonRect.height);}let fb=20*scaleFactorHeight;ctx.fillStyle="#FFFFFF";ctx.font=`bold ${fb}px Arial`;ctx.textAlign="center";ctx.textBaseline="middle";if(startButtonRect)ctx.fillText("Iniciar Jogo",startButtonRect.x+startButtonRect.width/2,startButtonRect.y+startButtonRect.height/2);if(shopButtonRect)ctx.fillText("Loja",shopButtonRect.x+shopButtonRect.width/2,shopButtonRect.y+shopButtonRect.height/2);if(leaderboardButtonRect)ctx.fillText("Líderes",leaderboardButtonRect.x+leaderboardButtonRect.width/2,leaderboardButtonRect.y+leaderboardButtonRect.height/2);ctx.textBaseline="alphabetic";const uiY=25*scaleFactorHeight,ux=10*scaleFactorWidth,sp=10*scaleFactorWidth;let cX=ux;if(coinImageLoaded){ctx.drawImage(coinImage,cX,uiY-iconSize*0.8,iconSize,iconSize);cX+=iconSize+sp;}ctx.fillStyle="#FFFFFF";ctx.strokeStyle="#000000";ctx.lineWidth=1;ctx.font=`${20*scaleFactorHeight}px Arial`;ctx.textAlign="left";ctx.strokeText(`${coins}`,cX,uiY);ctx.fillText(`${coins}`,cX,uiY);}catch(e){} } else if (gameState === 'SHOP') { try{const uiY=25*scaleFactorHeight,ux=10*scaleFactorWidth,sp=10*scaleFactorWidth;let cX=ux;if(coinImageLoaded){ctx.drawImage(coinImage,cX,uiY-iconSize*0.8,iconSize,iconSize);cX+=iconSize+sp;}ctx.fillStyle="#FFFFFF";ctx.strokeStyle="#000000";ctx.lineWidth=1;ctx.font=`${20*scaleFactorHeight}px Arial`;ctx.textAlign="left";ctx.strokeText(`${coins}`, cX, uiY);ctx.fillText(`${coins}`, cX, uiY);let itemY = 100*scaleFactorHeight;ctx.fillStyle = "#FFFFFF"; ctx.textAlign = "center"; ctx.font = `bold ${25*scaleFactorHeight}px Arial`;ctx.strokeText("Comprar 1 Vida Extra", canvas.width / 2, itemY); ctx.fillText("Comprar 1 Vida Extra", canvas.width / 2, itemY);itemY += 35*scaleFactorHeight;ctx.font = `${20*scaleFactorHeight}px Arial`;ctx.strokeText(`Custo: ${costOfSingleLife} Moedas`, canvas.width / 2, itemY); ctx.fillText(`Custo: ${costOfSingleLife} Moedas`, canvas.width / 2, itemY);if(shopBuyLivesButtonRect){ctx.fillStyle="#00A000";ctx.strokeStyle="#006400";ctx.lineWidth=2*scaleFactorHeight;ctx.fillRect(shopBuyLivesButtonRect.x,shopBuyLivesButtonRect.y,shopBuyLivesButtonRect.width,shopBuyLivesButtonRect.height);ctx.strokeRect(shopBuyLivesButtonRect.x,shopBuyLivesButtonRect.y,shopBuyLivesButtonRect.width,shopBuyLivesButtonRect.height);ctx.fillStyle="#FFFFFF";ctx.font=`bold ${20*scaleFactorHeight}px Arial`;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("Comprar",shopBuyLivesButtonRect.x+shopBuyLivesButtonRect.width/2,shopBuyLivesButtonRect.y+shopBuyLivesButtonRect.height/2);ctx.textBaseline="alphabetic";}if(shopMessageTimer>0){shopMessageTimer--;ctx.fillStyle=(shopMessage.includes("sucesso"))?"#00FF00":"#FF0000";ctx.font=`bold ${18*scaleFactorHeight}px Arial`;ctx.textAlign="center";ctx.fillText(shopMessage,canvas.width/2,shopBuyLivesButtonRect.y+buttonHeight+20*scaleFactorHeight);}if(shopBackButtonRect){ctx.fillStyle="#A00000";ctx.strokeStyle="#640000";ctx.lineWidth=2*scaleFactorHeight;ctx.fillRect(shopBackButtonRect.x,shopBackButtonRect.y,shopBackButtonRect.width,shopBackButtonRect.height);ctx.strokeRect(shopBackButtonRect.x,shopBackButtonRect.y,shopBackButtonRect.width,shopBackButtonRect.height);ctx.fillStyle="#FFFFFF";ctx.font=`bold ${20*scaleFactorHeight}px Arial`;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("Voltar",shopBackButtonRect.x+shopBackButtonRect.width/2,shopBackButtonRect.y+shopBackButtonRect.height/2);ctx.textBaseline="alphabetic";}} catch(e){} } else if (gameState === 'LEADERBOARD') { try{let tfs=30*scaleFactorHeight;let efs=18*scaleFactorHeight;let es=efs*1.5;let py=20*scaleFactorHeight;let pW=canvas.width*0.7;let ph=py*2+tfs*1.8+(Math.max(leaderboardData.length,1)*es);let pX=(canvas.width-pW)/2;let pY=60*scaleFactorHeight-tfs*0.8;ctx.fillStyle="rgba(80,80,80,0.8)";ctx.strokeStyle="rgba(200,200,200,0.9)";ctx.lineWidth=2*scaleFactorHeight;ctx.fillRect(pX,pY,pW,ph);ctx.strokeRect(pX,pY,pW,ph);let cy=pY+py+tfs/2;ctx.fillStyle="#FFFFFF";ctx.strokeStyle="#000000";ctx.lineWidth=1.5*scaleFactorHeight;ctx.font=`bold ${tfs}px Arial`;ctx.textAlign="center";ctx.strokeText("Quadro de Líderes",canvas.width/2,cy);ctx.fillText("Quadro de Líderes",canvas.width/2,cy);cy+=tfs*1.8;ctx.font=`${efs}px Arial`;const rX=pX+pW*0.15;const nX=pX+pW*0.30;const sX=pX+pW*0.85;if(leaderboardData.length===0){ctx.textAlign="center";ctx.fillText("- Nenhum recorde -",canvas.width/2,cy);}else{leaderboardData.forEach((en,i)=>{if(i<MAX_LEADERBOARD_ENTRIES){ctx.fillStyle="#FFFFFF";ctx.textAlign="right";ctx.strokeText(`${i+1}.`,rX,cy);ctx.fillText(`${i+1}.`,rX,cy);ctx.textAlign="left";ctx.strokeText(en.name,nX,cy);ctx.fillText(en.name,nX,cy);ctx.textAlign="right";ctx.strokeText(en.score.toString(),sX,cy);ctx.fillText(en.score.toString(),sX,cy);cy+=es;}});}if(leaderboardBackButtonRect){ctx.fillStyle="#A00000";ctx.strokeStyle="#640000";ctx.lineWidth=2*scaleFactorHeight;ctx.fillRect(leaderboardBackButtonRect.x,leaderboardBackButtonRect.y,leaderboardBackButtonRect.width,leaderboardBackButtonRect.height);ctx.strokeRect(leaderboardBackButtonRect.x,leaderboardBackButtonRect.y,leaderboardBackButtonRect.width,leaderboardBackButtonRect.height);ctx.fillStyle="#FFFFFF";ctx.font=`bold ${20*scaleFactorHeight}px Arial`;ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("Voltar",leaderboardBackButtonRect.x+leaderboardBackButtonRect.width/2,leaderboardBackButtonRect.y+leaderboardBackButtonRect.height/2);ctx.textBaseline="alphabetic";}} catch(e){} } else if (gameState === 'PLAYING') { try{if(obstacleImageLoaded){for(let o of obstacles){ctx.drawImage(o.image,o.x,o.y,o.width,o.height);}}let dP=!isInvincible||Math.floor(Date.now()/100)%2===0;if(dP&&playerImageLoaded){ctx.drawImage(playerImage,playerX,playerY,playerWidth,playerHeight);}const uiY_play=25*scaleFactorHeight,ux_play=10*scaleFactorWidth,sp_play=10*scaleFactorWidth;ctx.fillStyle="#000000";ctx.font=`${20*scaleFactorHeight}px Arial`;ctx.textAlign="left";let cX_play=ux_play;ctx.fillText(`Score:${score}`,cX_play,uiY_play);cX_play+=ctx.measureText(`Score:${score}`).width+sp_play*2;if(coinImageLoaded){ctx.drawImage(coinImage,cX_play,uiY_play-iconSize*0.8,iconSize,iconSize);cX_play+=iconSize+sp_play;}ctx.fillText(`${coins}`,cX_play,uiY_play);cX_play+=ctx.measureText(`${coins}`).width+sp_play*2;if(lifeImageLoaded){for(let i=0;i<currentLives;i++){ctx.drawImage(lifeImage,cX_play+i*(iconSize+sp_play*0.5),uiY_play-iconSize*0.8,iconSize,iconSize);}}} catch(e){} } else if (gameState === 'GAME_OVER') { try{if(obstacleImageLoaded){for(let o of obstacles){ctx.drawImage(o.image,o.x,o.y,o.width,o.height);}}if(playerImageLoaded){ctx.drawImage(playerImage,playerX,playerY,playerWidth,playerHeight);}ctx.fillStyle="rgba(0,0,0,0.7)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#ffffff";let fgo=40*scaleFactorHeight,fsc=20*scaleFactorHeight,fr=16*scaleFactorHeight;ctx.font=`${fgo}px Arial`;ctx.textAlign="center";ctx.fillText("Game Over",canvas.width/2,canvas.height/2-fgo);ctx.font=`${fsc}px Arial`;ctx.fillText(`Score Final:${score}`,canvas.width/2,canvas.height/2);ctx.font=`${fr}px Arial`;ctx.fillText("Pressione ESPAÇO para Voltar ao Menu",canvas.width/2,canvas.height/2+fsc*1.5);} catch(e){} }
        } // Fim draw

        function gameLoop() { try{update();draw();animationFrameId=requestAnimationFrame(gameLoop);}catch(e){console.error("Erro fatal loop:",e);} }

        // --- Ouvintes de Evento ---
        document.addEventListener('keydown', (event) => { if (event.code === 'Space') { event.preventDefault(); handlePrimaryAction(); } });
        window.addEventListener('resize', resizeAndScale);
        canvas.addEventListener('click', handleMouseClick);
        canvas.addEventListener('touchstart', (event) => { event.preventDefault(); handleMouseClick(event.touches[0]); });

        // <<< MOUSE CLICK HANDLER ATUALIZADO PARA GAME OVER >>>
        function handleMouseClick(event) {
             const rect = canvas.getBoundingClientRect();
             const clickX = (event.clientX || event.pageX) - rect.left;
             const clickY = (event.clientY || event.pageY) - rect.top;

             if (gameState === 'MENU') {
                 if(startButtonRect&&clickX>=startButtonRect.x&&clickX<=startButtonRect.x+startButtonRect.width&&clickY>=startButtonRect.y&&clickY<=startButtonRect.y+startButtonRect.height){gameState='PLAYING';resetGame();}
                 else if(shopButtonRect&&clickX>=shopButtonRect.x&&clickX<=shopButtonRect.x+shopButtonRect.width&&clickY>=shopButtonRect.y&&clickY<=shopButtonRect.y+shopButtonRect.height){gameState='SHOP';shopMessage="";shopMessageTimer=0;}
                 else if(leaderboardButtonRect&&clickX>=leaderboardButtonRect.x&&clickX<=leaderboardButtonRect.x+leaderboardButtonRect.width&&clickY>=leaderboardButtonRect.y&&clickY<=leaderboardButtonRect.y+leaderboardButtonRect.height){gameState='LEADERBOARD';}
             } else if (gameState === 'SHOP') {
                 if(shopBackButtonRect&&clickX>=shopBackButtonRect.x&&clickX<=shopBackButtonRect.x+shopBackButtonRect.width&&clickY>=shopBackButtonRect.y&&clickY<=shopBackButtonRect.y+shopBackButtonRect.height){gameState='MENU';}
                 else if(shopBuyLivesButtonRect&&clickX>=shopBuyLivesButtonRect.x&&clickX<=shopBuyLivesButtonRect.x+shopBuyLivesButtonRect.width&&clickY>=shopBuyLivesButtonRect.y&&clickY<=shopBuyLivesButtonRect.y+shopBuyLivesButtonRect.height){if(startingLivesBase+purchasedExtraLives>=maxTotalLives){shopMessage="Máximo de vidas atingido!";shopMessageTimer=120;}else if(coins>=costOfSingleLife){coins-=costOfSingleLife;purchasedExtraLives+=1;saveData();shopMessage="Compra realizada com sucesso!";shopMessageTimer=120;}else{shopMessage="Moedas insuficientes!";shopMessageTimer=120;}}
             } else if (gameState === 'LEADERBOARD') {
                  if(leaderboardBackButtonRect&&clickX>=leaderboardBackButtonRect.x&&clickX<=leaderboardBackButtonRect.x+leaderboardBackButtonRect.width&&clickY>=leaderboardBackButtonRect.y&&clickY<=leaderboardBackButtonRect.y+leaderboardBackButtonRect.height){gameState='MENU';}
             } else if (gameState === 'PLAYING') { // Pular com toque/clique
                  if(onGround){jumpSound.currentTime=0;jumpSound.play();velocityY=jumpStrength;onGround=false;canDoubleJump=true;}
                  else if(canDoubleJump){jumpSound.currentTime=0;jumpSound.play();velocityY=doubleJumpStrength;canDoubleJump=false;}
             } else if (gameState === 'GAME_OVER') { // <<< ADICIONADO: Clique/Toque no Game Over volta ao Menu
                 isGameOver = false; // Reseta flag interna também
                 gameState = 'MENU';
                 console.log("Voltando para o menu via Click/Touch...");
             }
        } // Fim handleMouseClick

        // --- Inicia o Carregamento ---
        loadData();
        playerImage.src='images.png';obstacleImage.src='pedroaugusto.png';backgroundImage.src='fundo.png';coinImage.src='coin.png';lifeImage.src='vida.png';

    }); // Fim DOMContentLoaded
</script>

</body>
</html>
